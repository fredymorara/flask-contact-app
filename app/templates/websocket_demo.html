{% extends "base.html" %}

{% block title %}WebSocket Demo{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header">
                <h3 class="text-center">HTML5 WebSocket Demo</h3>
            </div>
            <div class="card-body">
                <p class="text-muted text-center">This is a real-time echo server. Type a message and it will be broadcast to everyone on this page. No authentication is required.</p>
                
                <div id="messages" class="form-control" style="height: 250px; overflow-y: scroll; background-color: #f8f9fa;">
                    <em class="text-muted">Connecting...</em>
                </div>

                <form id="message-form" class="mt-3">
                    <div class="input-group">
                        <input type="text" id="message-input" class="form-control" placeholder="Type your message..." autocomplete="off" required>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send-fill"></i> Send
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Connect to the Socket.IO server
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        var messagesDiv = document.getElementById('messages');
        var messageForm = document.getElementById('message-form');
        var messageInput = document.getElementById('message-input');

        // Handle connection event
        socket.on('connect', function() {
            messagesDiv.innerHTML = '<p class="text-success"><em>Connected!</em></p>';
        });

        // Handle 'server_message' event from the server
        socket.on('server_message', function(msg) {
            messagesDiv.innerHTML += '<p>' + msg.data + '</p>';
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll
        });

        // Handle form submission
        messageForm.addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent page reload
            var message = messageInput.value;
            if (message.trim() !== '') {
                socket.emit('client_message', {data: message}); // Send to server
                messageInput.value = ''; // Clear input
            }
        });
    });
</script>
{% endblock %}